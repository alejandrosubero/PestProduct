import{a as x}from"./chunk-RS2LLTYQ.js";import{a as M,c as O}from"./chunk-ULEETX37.js";import"./chunk-BC5DXUAT.js";import{a as n}from"./chunk-5V2UQUR6.js";import"./chunk-N7JV4PFX.js";import"./chunk-AX7SBEAB.js";import{e as B}from"./chunk-LW4S5ANT.js";import{i as P,l as v}from"./chunk-4MLLPPK3.js";import"./chunk-Q5HEFZWF.js";import"./chunk-CARY4E7O.js";import"./chunk-NFBI5KHV.js";import"./chunk-PFAMWQVE.js";import{t as C}from"./chunk-53DBWVNU.js";import{$b as S,Ab as l,Fb as h,Ib as d,Ob as w,Pb as _,Qb as y,Sb as f,Ya as m,aa as k,f as r,ga as g,la as b,ta as u,ua as p,zb as s}from"./chunk-WHT7HZRB.js";var D=(()=>{class a{constructor(){}exportAll(){return r(this,null,function*(){return{products:yield n.products.toArray(),packages:yield n.packages.toArray(),usageRecords:yield n.usageRecords.toArray(),formulations:yield n.formulations.toArray(),legacyProducts:yield n.legacyProducts.toArray()}})}getBackupBlob(){return r(this,null,function*(){let e=yield this.exportAll(),t=JSON.stringify(e,null,2);return new Blob([t],{type:"application/json"})})}importAll(e){return r(this,null,function*(){if(e.products)for(let t of e.products)delete t.id,yield n.products.add(t);if(e.packages)for(let t of e.packages)delete t.id,yield n.packages.add(t);if(e.usageRecords)for(let t of e.usageRecords)delete t.id,yield n.usageRecords.add(t);if(e.formulations)for(let t of e.formulations)delete t.id,yield n.formulations.add(t);if(e.legacyProducts)for(let t of e.legacyProducts)delete t.id,yield n.legacyProducts.add(t)})}clearAll(){return r(this,null,function*(){yield n.delete()})}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275prov=k({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var F=["fileInput"],G=(()=>{class a{constructor(e,t){this.dialog=e,this._snackBar=t,this.isFabOpen=!1,this.durationInSeconds=3,this.horizontalPosition="center",this.verticalPosition="bottom",this.backupService=g(D)}export(){return r(this,null,function*(){try{let e=yield this.backupService.getBackupBlob(),t=new File([e],`backup-${new Date().toISOString()}.json`,{type:"application/json"});if(navigator.share&&navigator.canShare?.({files:[t]}))try{yield navigator.share({title:"Backup",text:"PestControlDB Backup",files:[t]}),console.log("\u2705 Backup shared");return}catch(c){console.warn("\u26A0\uFE0F Share cancelled or failed, falling back to download:",c)}let i=URL.createObjectURL(e),o=document.createElement("a");o.href=i,o.download=`backup-${new Date().toISOString()}.json`,o.click(),URL.revokeObjectURL(i),console.log("\u2B07\uFE0F Backup downloaded"),this.openSnackBar("\u2B07\uFE0F Backup downloaded")}catch(e){this.durationInSeconds=5,console.error("\u274C Error exporting backup",e),this.openSnackBar("\u274C Error exporting backup")}})}openFilePicker(){this.fileInput.nativeElement.click()}onFileSelected(e){return r(this,null,function*(){let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];try{let o=yield i.text(),c=JSON.parse(o);yield this.backupService.importAll(c),this.openSnackBar("\u2705 Backup imported successfully")}catch(o){this.durationInSeconds=5,console.error("\u274C Error importing backup",o),this.openSnackBar("\u274C Error importing backup")}finally{t.value="",this.durationInSeconds=3}}})}clear(){return r(this,null,function*(){yield this.backupService.clearAll(),this.showSnackBar("\u{1F5D1}\uFE0F All databases cleared")})}confirmDelete(){this.isFabOpen=!1,this.dialog.open(O,{data:{message:"Are you sure you want to delete this formulation?"}}).afterClosed().subscribe(t=>{t&&this.clear()})}openSnackBar(e){this._snackBar.open(e,"Ok",{duration:this.durationInSeconds*1e3,horizontalPosition:this.horizontalPosition,verticalPosition:this.verticalPosition})}showSnackBar(e){this.durationInSeconds=6,this._snackBar.open(e,"OK",{duration:this.durationInSeconds*1e3,horizontalPosition:this.horizontalPosition,verticalPosition:this.verticalPosition}).onAction().subscribe(()=>{window.location.reload()})}static{this.\u0275fac=function(t){return new(t||a)(m(M),m(x))}}static{this.\u0275cmp=b({type:a,selectors:[["app-backup"]],viewQuery:function(t,i){if(t&1&&w(F,5),t&2){let o;_(o=y())&&(i.fileInput=o.first)}},standalone:!0,features:[S],decls:11,vars:0,consts:[["fileInput",""],[1,"backup-container"],[1,"ios-button","export",3,"click"],[1,"ios-button","import",3,"click"],["type","file","accept",".json",2,"display","none",3,"change"],[1,"ios-button","clear",3,"click"]],template:function(t,i){if(t&1){let o=h();s(0,"div",1)(1,"h2"),f(2,"\u{1F4E6} Data Backup"),l(),s(3,"button",2),d("click",function(){return u(o),p(i.export())}),f(4," \u{1F4E4} Export / Share Backup "),l(),s(5,"button",3),d("click",function(){return u(o),p(i.openFilePicker())}),f(6," \u{1F4E5} Import Backup "),l(),s(7,"input",4,0),d("change",function(I){return u(o),p(i.onFileSelected(I))}),l(),s(9,"button",5),d("click",function(){return u(o),p(i.confirmDelete())}),f(10," \u{1F5D1}\uFE0F Clear Database "),l()()}},dependencies:[P,C,v,B],styles:[".backup-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem}.backup-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;margin-bottom:1.5rem;color:#333}.backup-container[_ngcontent-%COMP%]   .ios-button[_ngcontent-%COMP%]{width:90%;max-width:320px;padding:14px 18px;margin:10px 0;border-radius:12px;border:none;font-size:1.1rem;font-weight:500;text-align:center;cursor:pointer;transition:background .3s}.backup-container[_ngcontent-%COMP%]   .ios-button.export[_ngcontent-%COMP%]{background:#007aff;color:#fff}.backup-container[_ngcontent-%COMP%]   .ios-button.export[_ngcontent-%COMP%]:hover{background:#005ecb}.backup-container[_ngcontent-%COMP%]   .ios-button.import[_ngcontent-%COMP%]{background:#34c759;color:#fff}.backup-container[_ngcontent-%COMP%]   .ios-button.import[_ngcontent-%COMP%]:hover{background:#2fa94c}.backup-container[_ngcontent-%COMP%]   .ios-button.clear[_ngcontent-%COMP%]{background:#ff3b30;color:#fff}.backup-container[_ngcontent-%COMP%]   .ios-button.clear[_ngcontent-%COMP%]:hover{background:#d92d23}"]})}}return a})();export{G as BackupComponent};

import{a as at}from"./chunk-HNPOORT2.js";import{a as st}from"./chunk-DG2GUF4V.js";import{a as it}from"./chunk-6FCDGXAG.js";import"./chunk-JYKJOJ6J.js";import{a as et}from"./chunk-S456R345.js";import{d as Z}from"./chunk-WI6ZF6X7.js";import{a as B,e as j}from"./chunk-5ETXQJ6Z.js";import{a as J,f as X}from"./chunk-4SPE7LMF.js";import{c as z,i as W,j as Q,l as Y,m as K}from"./chunk-RPOOMM4R.js";import{a as rt}from"./chunk-MAELP3WW.js";import"./chunk-7GZRYZ3W.js";import"./chunk-CARY4E7O.js";import{d as tt}from"./chunk-EYGZ565A.js";import"./chunk-HEOXUAG5.js";import{b as V}from"./chunk-NMLM2UYX.js";import{a as N,c as O}from"./chunk-JVFQFS5Z.js";import{c as T,ma as $,na as H}from"./chunk-OUSHV2EZ.js";import{a as ot,b as nt}from"./chunk-NKIKHFFW.js";import{b as I,d as g,f as k,g as A,j as E,l as L,m as U,r as D,s as G,t as R,u as q}from"./chunk-ZQAR5GQS.js";import{$a as d,Cb as r,Db as o,Eb as f,Ib as S,Lb as c,Nb as p,Nc as F,Rb as C,Sb as b,Tb as M,Tc as P,Vb as a,Xb as y,_a as m,cc as w,ja as s,oa as h,rb as _,tb as u,wa as x,xa as v}from"./chunk-BTT23VXK.js";var mt=["textarea"];function ct(l,ut){if(l&1){let t=S();r(0,"div",9)(1,"button",10),c("click",function(){x(t);let i=p();return v(i.acceptSuggestion())}),a(2),o(),f(3,"br")(4,"br"),o()}if(l&2){let t=p();m(2),y(" ",t.suggestion," ")}}var jt=(()=>{class l{constructor(t,e){this.service=t,this.router=e,this.title="",this.content="",this.formulation={id:0,title:"",content:""},this.text="",this.suggestion="",this.allProducts=[],this.fb=s(G),this.navegateService=s(rt),this.db=s(it),this.navService=s(nt),this.unitService=s(st),this.productService=s(et),this.route=s(N),this.id=0,this.PRODUCTS=[],this.UNITS=[],this.ALL_SUGGESTIONS=[],this.updateUnits("Liquid"),this.setNav()}ngOnInit(){this.form=this.fb.group({title:[this.formulation.title,g.required],content:[this.formulation.content,g.required]})}updateUnits(t){t!=null&&t!=null&&(this.UNITS=this.unitService.getUnitsByProductType(t),this.PRODUCTS=this.getProductNames(),this.UNITS.length>0?this.ALL_SUGGESTIONS=[...new Set([...this.PRODUCTS,...this.UNITS])].sort():this.UNITS=["oz","fl oz","gal","L","mL","g","kg","lb","ft","m","sq ft","sq m"])}getProductNames(){let t=this.productService.products(),e=[];return t!=null&&t!=null&&(e=t.map(i=>i.name)),e}save(){let t={id:Date.now(),title:this.form.value.title,content:this.form.value.content};this.db.addFormulations(t),this.goBack()}cancel(){this.goBack()}goBack(){this.navegateService.goFavorites("formulations",this.id)}handleInputChange(){this.form.get("content")?.valueChanges.subscribe(e=>{this.text=e});let t=this.text.match(/(\S+)$/);if(t&&t[1]){let e=t[1],i=this.ALL_SUGGESTIONS.find(n=>n.toLowerCase().startsWith(e.toLowerCase())&&n.toLowerCase()!==e.toLowerCase());this.suggestion=i||""}else this.suggestion=""}acceptSuggestion(){if(!this.suggestion)return;let t=this.text.match(/(\S+)$/),e;if(t){let i=t[1];e=this.text.substring(0,this.text.length-i.length)+this.suggestion+" "}else e=this.text+this.suggestion+" ";this.text=e,this.form.get("content")?.setValue(this.text),this.suggestion="",setTimeout(()=>this.textareaRef.nativeElement.focus(),0)}handleKeyDown(t){(t.key==="Tab"||t.key==="Enter")&&this.suggestion&&(t.preventDefault(),this.acceptSuggestion())}setNav(){this.navService.reSetNavConfig();let t=new ot;t.title="Add Formulation",t.ico.menu=!1,t.ico.back=!0,t.ico.favorite=!1,t.ico.logut=!1,t.ico.label=!1,t.ico.sds=!1,t.favorite.url="formulations",this.id&&(t.favorite.id=this.id),t.goto="formulations",this.navService.setNavConfig(t)}static{this.\u0275fac=function(e){return new(e||l)(d(at),d(O))}}static{this.\u0275cmp=h({type:l,selectors:[["app-formulation-add"]],viewQuery:function(e,i){if(e&1&&C(mt,5),e&2){let n;b(n=M())&&(i.textareaRef=n.first)}},standalone:!0,features:[w],decls:21,vars:3,consts:[[1,"formulation-card"],[1,"form-content",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","required",""],["class","w-full h-16 flex items-center justify-center mt-2 pat",4,"ngIf"],["matInput","","placeholder","Suspend 1 oz ft..","rows","6","formControlName","content","required","",3,"input","keydown"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","warn","type","button",3,"click"],[1,"w-full","h-16","flex","items-center","justify-center","mt-2","pat"],[1,"bg-cyan-600","text-white","text-lg","font-semibold","px-6","py-3","rounded-lg","shadow-lg","transform","active:scale-95","transition-transform","duration-100","ease-in-out",3,"click"]],template:function(e,i){e&1&&(r(0,"mat-card",0)(1,"form",1),c("ngSubmit",function(){return i.save()}),r(2,"mat-form-field",2)(3,"mat-label"),a(4,"Title"),o(),f(5,"input",3),o(),_(6,ct,5,1,"div",4),r(7,"mat-form-field",2)(8,"mat-label"),a(9,"Formulation"),o(),r(10,"textarea",5),c("input",function(){return i.handleInputChange()})("keydown",function(lt){return i.handleKeyDown(lt)}),a(11,"    "),o()(),r(12,"div",6)(13,"button",7)(14,"mat-icon"),a(15,"save"),o(),a(16,"\xA0Save "),o(),r(17,"button",8),c("click",function(){return i.cancel()}),r(18,"mat-icon"),a(19,"cancel"),o(),a(20,"\xA0Cancel "),o()()()()),e&2&&(m(),u("formGroup",i.form),m(5),u("ngIf",i.suggestion),m(7),u("disabled",i.form.invalid))},dependencies:[P,F,T,R,E,I,k,A,D,V,j,B,K,Y,W,z,H,$,X,J,Z,tt,q,L,U,Q],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;min-height:calc(100vh - 56px);background-color:#f9f9f9}.formulation-card[_ngcontent-%COMP%]{padding:16px;margin:8px 0;border:1px solid #ccc;border-radius:8px;height:100%}.custom-textarea[_ngcontent-%COMP%]{font-size:19px!important;color:#000!important;-webkit-text-fill-color:#000!important;opacity:1!important;font-family:inherit;background-color:transparent}.full-width[_ngcontent-%COMP%]{width:100%;flex:1}.pat[_ngcontent-%COMP%]{margin-bottom:16 px;padding-bottom:10 px}.title[_ngcontent-%COMP%]{margin-top:0;font-size:20px;font-weight:600;text-align:center}.formulation-form[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:column;gap:1rem}.actions[_ngcontent-%COMP%]{display:flex;gap:1rem}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;margin-top:16px;flex-wrap:wrap}.fab-container[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;display:flex;flex-direction:column-reverse;align-items:flex-end;z-index:100}.fab-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:12px;box-shadow:0 4px 12px #0000004d;transition:transform .3s ease,opacity .3s ease}.fab-container[_ngcontent-%COMP%]   .fab-action[_ngcontent-%COMP%]{opacity:1;transform:translateY(0);animation:_ngcontent-%COMP%_slide-up .3s ease forwards}@keyframes _ngcontent-%COMP%_slide-up{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.green-fab[_ngcontent-%COMP%]{background-color:#217724!important;color:#fff}.green-fab[_ngcontent-%COMP%]:hover{background-color:#43a047!important}"]})}}return l})();export{jt as FormulationAddComponent};

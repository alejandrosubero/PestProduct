import{a as nt}from"./chunk-DG2GUF4V.js";import{a as tt}from"./chunk-6FCDGXAG.js";import"./chunk-JYKJOJ6J.js";import{a as Z}from"./chunk-S456R345.js";import{d as J}from"./chunk-WI6ZF6X7.js";import{a as V,e as A}from"./chunk-5ETXQJ6Z.js";import{a as $,f as H}from"./chunk-4SPE7LMF.js";import{c as z,i as B,j,l as W,m as Q}from"./chunk-RPOOMM4R.js";import{a as ot}from"./chunk-MAELP3WW.js";import"./chunk-7GZRYZ3W.js";import"./chunk-CARY4E7O.js";import{d as X}from"./chunk-EYGZ565A.js";import"./chunk-HEOXUAG5.js";import{b as R}from"./chunk-NMLM2UYX.js";import{a as N}from"./chunk-JVFQFS5Z.js";import{c as I,ma as Y,na as K}from"./chunk-OUSHV2EZ.js";import{a as et,b as it}from"./chunk-NKIKHFFW.js";import{b as P,d as p,f as E,g as F,j as O,l as k,m as D,r as L,s as U,t as G,u as q}from"./chunk-ZQAR5GQS.js";import{Cb as r,Db as o,Eb as d,Ib as _,Lb as u,Nb as f,Nc as w,Rb as b,Sb as S,Tb as C,Tc as T,Vb as a,Xb as M,_a as m,cc as y,ja as s,oa as g,rb as x,tb as c,wa as h,xa as v}from"./chunk-BTT23VXK.js";var at=["textarea"];function st(l,lt){if(l&1){let t=_();r(0,"div",9)(1,"button",10),u("click",function(){h(t);let i=f();return v(i.acceptSuggestion())}),a(2),o(),d(3,"br")(4,"br"),o()}if(l&2){let t=f();m(2),M(" ",t.suggestion," ")}}var qt=(()=>{class l{constructor(){this.title="",this.content="",this.formulation={id:0,title:"",content:""},this.text="",this.suggestion="",this.allProducts=[],this.fb=s(U),this.navegateService=s(ot),this.db=s(tt),this.navService=s(it),this.unitService=s(nt),this.productService=s(Z),this.route=s(N),this.id=0,this.PRODUCTS=[],this.UNITS=[],this.ALL_SUGGESTIONS=[],this.updateUnits("Liquid")}ngOnInit(){this.formulationId=Number(this.route.snapshot.paramMap.get("id"));let t;this.formulationId!==void 0&&this.formulationId!==null&&this.db.getFormulationsById(this.formulationId).then(e=>{t=e,t!=null&&t!=null&&(this.form=this.fb.group({title:[t.title,p.required],content:[t.content,p.required]})),this.setNav()})}updateUnits(t){t!=null&&t!=null&&(this.UNITS=this.unitService.getUnitsByProductType(t),this.PRODUCTS=this.getProductNames(),this.UNITS.length>0?this.ALL_SUGGESTIONS=[...new Set([...this.PRODUCTS,...this.UNITS])].sort():this.UNITS=["oz","fl oz","gal","L","mL","g","kg","lb","ft","m","sq ft","sq m"])}getProductNames(){let t=this.productService.products(),e=[];return t!=null&&t!=null&&(e=t.map(i=>i.name)),e}handleInputChange(){this.form.get("content")?.valueChanges.subscribe(e=>{this.text=e});let t=this.text.match(/(\S+)$/);if(t&&t[1]){let e=t[1],i=this.ALL_SUGGESTIONS.find(n=>n.toLowerCase().startsWith(e.toLowerCase())&&n.toLowerCase()!==e.toLowerCase());this.suggestion=i||""}else this.suggestion=""}acceptSuggestion(){if(!this.suggestion)return;let t=this.text.match(/(\S+)$/),e;if(t){let i=t[1];e=this.text.substring(0,this.text.length-i.length)+this.suggestion+" "}else e=this.text+this.suggestion+" ";this.text=e,this.form.get("content")?.setValue(this.text),this.suggestion="",setTimeout(()=>this.textareaRef.nativeElement.focus(),0)}handleKeyDown(t){(t.key==="Tab"||t.key==="Enter")&&this.suggestion&&(t.preventDefault(),this.acceptSuggestion())}setNav(){this.navService.reSetNavConfig();let t=new et;t.title="Edit Formulation",t.ico.menu=!1,t.ico.back=!0,t.ico.favorite=!1,t.ico.logut=!1,t.ico.label=!1,t.ico.sds=!1,t.favorite.url="formulations",this.id&&(t.favorite.id=this.id),t.goto="formulations",this.navService.setNavConfig(t)}save(){let t={id:this.formulationId,title:this.form.value.title,content:this.form.value.content};this.db.updateFormulations(t),this.goToDetail(this.formulationId)}cancel(){this.navegateService.goFavorites("formulations",this.id)}goToDetail(t){this.navegateService.goToDetail("app/formulation",t,"formulations")}static{this.\u0275fac=function(e){return new(e||l)}}static{this.\u0275cmp=g({type:l,selectors:[["app-formulation-add"]],viewQuery:function(e,i){if(e&1&&b(at,5),e&2){let n;S(n=C())&&(i.textareaRef=n.first)}},standalone:!0,features:[y],decls:21,vars:3,consts:[[1,"formulation-card"],[1,"form-content",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","required",""],["class","w-full h-16 flex items-center justify-center mt-2 pat",4,"ngIf"],["matInput","","placeholder","Suspend 1 oz ft..","rows","6","formControlName","content","required","",3,"input","keydown"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","warn","type","button",3,"click"],[1,"w-full","h-16","flex","items-center","justify-center","mt-2","pat"],[1,"bg-cyan-600","text-white","text-lg","font-semibold","px-6","py-3","rounded-lg","shadow-lg","transform","active:scale-95","transition-transform","duration-100","ease-in-out",3,"click"]],template:function(e,i){e&1&&(r(0,"mat-card",0)(1,"form",1),u("ngSubmit",function(){return i.save()}),r(2,"mat-form-field",2)(3,"mat-label"),a(4,"Title"),o(),d(5,"input",3),o(),x(6,st,5,1,"div",4),r(7,"mat-form-field",2)(8,"mat-label"),a(9,"Formulation"),o(),r(10,"textarea",5),u("input",function(){return i.handleInputChange()})("keydown",function(rt){return i.handleKeyDown(rt)}),a(11,"    "),o()(),r(12,"div",6)(13,"button",7)(14,"mat-icon"),a(15,"save"),o(),a(16,"\xA0Save "),o(),r(17,"button",8),u("click",function(){return i.cancel()}),r(18,"mat-icon"),a(19,"cancel"),o(),a(20,"\xA0Cancel "),o()()()()),e&2&&(m(),c("formGroup",i.form),m(5),c("ngIf",i.suggestion),m(7),c("disabled",i.form.invalid))},dependencies:[T,w,I,G,O,P,E,F,L,R,A,V,Q,W,B,z,K,Y,H,$,J,X,q,k,D,j],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh;background-color:#f9f9f9}.detail[_ngcontent-%COMP%]{padding:1rem}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:1rem}.formulation-card[_ngcontent-%COMP%]{padding:16px;margin:8px 0;border:1px solid #ccc;border-radius:8px;height:100%}.custom-textarea[_ngcontent-%COMP%]{font-size:19px!important;color:#000!important;-webkit-text-fill-color:#000!important;opacity:1!important;font-family:inherit;background-color:transparent}mat-toolbar[_ngcontent-%COMP%]{flex:0 0 auto}.full-width[_ngcontent-%COMP%]{width:100%;flex:1}.title[_ngcontent-%COMP%]{margin-top:0;font-size:20px;font-weight:600;text-align:center}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;margin-top:16px;flex-wrap:wrap}.fab-container[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;display:flex;flex-direction:column-reverse;align-items:flex-end;z-index:100}.fab-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:12px;box-shadow:0 4px 12px #0000004d;transition:transform .3s ease,opacity .3s ease}.fab-container[_ngcontent-%COMP%]   .fab-action[_ngcontent-%COMP%]{opacity:1;transform:translateY(0);animation:_ngcontent-%COMP%_slide-up .3s ease forwards}@keyframes _ngcontent-%COMP%_slide-up{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.green-fab[_ngcontent-%COMP%]{background-color:#217724!important;color:#fff}.green-fab[_ngcontent-%COMP%]:hover{background-color:#43a047!important}"]})}}return l})();export{qt as FormulationEditComponent};
